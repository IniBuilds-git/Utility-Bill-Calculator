<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<BorderPane prefHeight="700.0" prefWidth="900.0" style="-fx-background-color: #f1f5f9;" xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.utilitybill.controller.CustomerDetailsController">
    
    <!-- Header Section -->
    <top>
        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 20; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 0);">
            <HBox alignment="CENTER_LEFT" spacing="20">
                <VBox HBox.hgrow="ALWAYS">
                    <Label fx:id="customerNameLabel" text="Customer Name">
                        <font>
                            <Font name="System Bold" size="24.0" />
                        </font>
                    </Label>
                    <Label fx:id="accountNumberLabel" style="-fx-text-fill: #64748b; -fx-font-size: 14px;" text="Account #12345678" />
                </VBox>
                <VBox alignment="CENTER_RIGHT">
                    <Label text="Current Balance" style="-fx-text-fill: #64748b; -fx-font-size: 12px;" />
                    <Label fx:id="balanceLabel" text="£0.00" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #0d9488;" />
                </VBox>
                 <Button text="Close" onAction="#close" style="-fx-background-color: #e2e8f0; -fx-text-fill: #475569; -fx-cursor: hand;" />
            </HBox>
             <HBox spacing="20">
                <Label fx:id="emailLabel" style="-fx-text-fill: #475569;" text="email@example.com" />
                <Label text="|" style="-fx-text-fill: #cbd5e1;" />
                <Label fx:id="phoneLabel" style="-fx-text-fill: #475569;" text="07700 900000" />
                <Label text="|" style="-fx-text-fill: #cbd5e1;" />
                <Label fx:id="addressLabel" style="-fx-text-fill: #475569;" text="123 Example St, City" />
            </HBox>
        </VBox>
    </top>

    <!-- Main Content -->
    <center>
        <TabPane fx:id="mainTabPane" style="-fx-background-color: transparent;" tabClosingPolicy="UNAVAILABLE">
            <tabs>
                <!-- Overview Tab -->
                <Tab text="Overview">
                    <content>
                        <VBox spacing="20" style="-fx-padding: 20;">
                            <!-- Summary Cards -->
                            <HBox spacing="15">
                                <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.05), 5, 0, 0, 0);" HBox.hgrow="ALWAYS">
                                    <Label text="Active Tariff" style="-fx-text-fill: #64748b; -fx-font-size: 12px;" />
                                    <Label fx:id="tariffNameLabel" text="Standard Plan" style="-fx-font-size: 16px; -fx-font-weight: bold;" />
                                </VBox>
                                <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.05), 5, 0, 0, 0);" HBox.hgrow="ALWAYS">
                                    <Label text="Meter Count" style="-fx-text-fill: #64748b; -fx-font-size: 12px;" />
                                    <Label fx:id="meterCountLabel" text="0" style="-fx-font-size: 16px; -fx-font-weight: bold;" />
                                </VBox>
                                <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.05), 5, 0, 0, 0);" HBox.hgrow="ALWAYS">
                                    <Label text="Last Payment" style="-fx-text-fill: #64748b; -fx-font-size: 12px;" />
                                    <Label fx:id="lastPaymentLabel" text="£0.00" style="-fx-font-size: 16px; -fx-font-weight: bold;" />
                                </VBox>
                                <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.05), 5, 0, 0, 0);" HBox.hgrow="ALWAYS">
                                    <Label text="Predicted Usage (Next Month)" style="-fx-text-fill: #64748b; -fx-font-size: 12px;" />
                                    <Label fx:id="predictedUsageLabel" text="0 kWh" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #0d9488;" />
                                </VBox>
                            </HBox>

                            <!-- Usage Chart Section (Placeholder for now, can adhere to implementation plan of having a chart) -->
                            <VBox style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 8;" VBox.vgrow="ALWAYS">
                                <Label text="Energy Usage History" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-padding: 0 0 10 0;" />
                                <BarChart fx:id="usageChart" animated="false" legendVisible="false">
                                    <xAxis>
                                        <CategoryAxis label="Reading Date" />
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis label="Consumption" />
                                    </yAxis>
                                </BarChart>
                            </VBox>
                        </VBox>
                    </content>
                </Tab>

                <!-- Meter Readings Tab -->
                <Tab text="Meter Readings">
                    <content>
                        <VBox spacing="10" style="-fx-padding: 20;">
                             <TableView fx:id="readingsTable" VBox.vgrow="ALWAYS" style="-fx-background-color: white; -fx-background-radius: 8;">
                                <columns>
                                    <TableColumn fx:id="readingDateCol" text="Date" prefWidth="120" />
                                    <TableColumn fx:id="readingMeterIdCol" text="Meter ID" prefWidth="100" />
                                    <TableColumn fx:id="readingValueCol" text="Reading" prefWidth="100" />
                                    <TableColumn fx:id="consumptionCol" text="Consumption" prefWidth="100" />
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                </columnResizePolicy>
                            </TableView>
                        </VBox>
                    </content>
                </Tab>

                <!-- Invoices Tab -->
                <Tab text="Invoices">
                    <content>
                        <VBox spacing="10" style="-fx-padding: 20;">
                            <TableView fx:id="invoicesTable" VBox.vgrow="ALWAYS" style="-fx-background-color: white; -fx-background-radius: 8;">
                                <columns>
                                    <TableColumn fx:id="invoiceNumberCol" text="Invoice #" prefWidth="120" />
                                    <TableColumn fx:id="invoiceDateCol" text="Date" prefWidth="120" />
                                    <TableColumn fx:id="invoiceAmountCol" text="Amount" prefWidth="100" />
                                    <TableColumn fx:id="invoiceStatusCol" text="Status" prefWidth="100" />
                                    <TableColumn fx:id="invoiceDueDateCol" text="Due Date" prefWidth="120" />
                                    <TableColumn fx:id="invoiceActionsCol" text="Actions" prefWidth="100" />
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                </columnResizePolicy>
                            </TableView>
                        </VBox>
                    </content>
                </Tab>

                 <!-- Payments Tab -->
                <Tab text="Payments">
                    <content>
                        <VBox spacing="10" style="-fx-padding: 20;">
                             <TableView fx:id="paymentsTable" VBox.vgrow="ALWAYS" style="-fx-background-color: white; -fx-background-radius: 8;">
                                <columns>
                                    <TableColumn fx:id="paymentDateCol" text="Date" prefWidth="120" />
                                    <TableColumn fx:id="paymentAmountCol" text="Amount" prefWidth="100" />
                                    <TableColumn fx:id="paymentMethodCol" text="Method" prefWidth="120" />
                                    <TableColumn fx:id="paymentRefCol" text="Reference" prefWidth="120" />
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                </columnResizePolicy>
                            </TableView>
                        </VBox>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </center>
</BorderPane>
